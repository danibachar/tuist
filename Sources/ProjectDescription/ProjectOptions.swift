import Foundation

extension Project {
    /// Options to configure a project.
    public struct Options: Codable, Equatable {
        /// Configures automatic target schemes generation.
        public var automaticSchemesOptions: AutomaticSchemesOptions

        /// Configures the default known regions
        public var defaultKnownRegions: [String]?

        /// Configures the development region.
        public var developmentRegion: String?

        /// Disables generating Bundle accessors.
        @available(*, deprecated, message: "Please use `bundleAccessorsOptions` instead")
        public var disableBundleAccessors: Bool { !bundleAccessorsOptions.enabled }

        /// Defines if and how bundle accessors are generated
        public var bundleAccessorsOptions: BundleAccessorOptions

        /// Suppress logging of environment in Run Script build phases.
        public var disableShowEnvironmentVarsInScriptPhases: Bool

        /// Disable synthesized resource accessors.
        public var disableSynthesizedResourceAccessors: Bool

        /// Configures text settings.
        public var textSettings: TextSettings

        /// Configures the name of the generated .xcodeproj.
        public var xcodeProjectName: String?

        @available(*, deprecated, message: "Please use `projectOptions` instead")
        public static func options(
            automaticSchemesOptions: AutomaticSchemesOptions = .enabled(),
            defaultKnownRegions: [String]? = nil,
            developmentRegion: String? = nil,
            disableBundleAccessors: Bool = false,
            disableShowEnvironmentVarsInScriptPhases: Bool = false,
            disableSynthesizedResourceAccessors: Bool = false,
            textSettings: TextSettings = .textSettings(),
            xcodeProjectName: String? = nil
        ) -> Self {
            return self.init(
                automaticSchemesOptions: automaticSchemesOptions,
                defaultKnownRegions: defaultKnownRegions,
                developmentRegion: developmentRegion,
                bundleAccessorsOptions: BundleAccessorOptions(
                    internalAccessors: !disableBundleAccessors,
                    publicAccessors: !disableBundleAccessors
                ),
                disableShowEnvironmentVarsInScriptPhases: disableShowEnvironmentVarsInScriptPhases,
                disableSynthesizedResourceAccessors: disableSynthesizedResourceAccessors,
                textSettings: textSettings,
                xcodeProjectName: xcodeProjectName
            )
        }

        public static func projectOptions(
            automaticSchemesOptions: AutomaticSchemesOptions = .enabled(),
            defaultKnownRegions: [String]? = nil,
            developmentRegion: String? = nil,
            bundleAccessorsOptions: BundleAccessorOptions = .default,
            disableShowEnvironmentVarsInScriptPhases: Bool = false,
            disableSynthesizedResourceAccessors: Bool = false,
            textSettings: TextSettings = .textSettings(),
            xcodeProjectName: String? = nil
        ) -> Self {
            self.init(
                automaticSchemesOptions: automaticSchemesOptions,
                defaultKnownRegions: defaultKnownRegions,
                developmentRegion: developmentRegion,
                bundleAccessorsOptions: bundleAccessorsOptions,
                disableShowEnvironmentVarsInScriptPhases: disableShowEnvironmentVarsInScriptPhases,
                disableSynthesizedResourceAccessors: disableSynthesizedResourceAccessors,
                textSettings: textSettings,
                xcodeProjectName: xcodeProjectName
            )
        }
    }
}

// MARK: - AutomaticSchemesOptions

extension Project.Options {
    /// Automatic schemes options allow customizing the generation of the target schemes.
    public enum AutomaticSchemesOptions: Codable, Equatable {
        /// Allows you to define what targets will be enabled for code coverage data gathering.
        public enum TargetSchemesGrouping: Codable, Equatable {
            /// Generate a single scheme for each project.
            case singleScheme

            /// Group schemes according to the suffix of their names.
            case byNameSuffix(build: Set<String>, test: Set<String>, run: Set<String>)

            /// Generate a scheme for each target.
            case notGrouped
        }

        /// Enable autogenerated schemes
        case enabled(
            targetSchemesGrouping: TargetSchemesGrouping = .byNameSuffix(
                build: ["Implementation", "Interface", "Mocks", "Testing"],
                test: ["Tests", "IntegrationTests", "UITests", "SnapshotTests"],
                run: ["App", "Demo"]
            ),
            codeCoverageEnabled: Bool = false,
            testingOptions: TestingOptions = [],
            testLanguage: SchemeLanguage? = nil,
            testRegion: String? = nil,
            testScreenCaptureFormat: ScreenCaptureFormat? = nil,
            runLanguage: SchemeLanguage? = nil,
            runRegion: String? = nil
        )

        /// Disable autogenerated schemes
        case disabled
    }

    /// The text settings options
    public struct TextSettings: Codable, Equatable {
        /// Whether tabs should be used instead of spaces
        public var usesTabs: Bool?

        /// The width of space indent
        public var indentWidth: UInt?

        /// The width of tab indent
        public var tabWidth: UInt?

        /// Whether lines should be wrapped or not
        public var wrapsLines: Bool?

        public static func textSettings(
            usesTabs: Bool? = nil,
            indentWidth: UInt? = nil,
            tabWidth: UInt? = nil,
            wrapsLines: Bool? = nil
        ) -> Self {
            self.init(usesTabs: usesTabs, indentWidth: indentWidth, tabWidth: tabWidth, wrapsLines: wrapsLines)
        }
    }
}

// MARK: - BundleAccessorOptions

extension Project.Options {
    /// Defines if and how bundle accessors are generated.
    /// Note these definitions are project wise, i.e no fine control per target.
    public struct BundleAccessorOptions: Codable, Hashable {
        /// Indicates wether or not to generate internal bundle accessors.
        /// This allows compliance with SPM bundle accessors code-generation.
        public let internalAccessors: Bool

        /// Indicates wether or not to generate public bundle accessors.
        /// such that consumers outside the target can access resources using that bundle from outside the Project targets
        public let publicAccessors: Bool

        /// Indicates if any of the options are enabled
        public var enabled: Bool { internalAccessors || publicAccessors }

        /// Initialization function for the BundleAccessorOptions
        /// - Parameters:
        ///   - internalAccessors: Indicates wether or not to generate internal bundle accessors.
        ///   - publicAccessors: Indicates wether or not to generate public bundle accessors.
        public init(internalAccessors: Bool, publicAccessors: Bool) {
            self.internalAccessors = internalAccessors
            self.publicAccessors = publicAccessors
        }

        public static let `default` = BundleAccessorOptions(internalAccessors: true, publicAccessors: true)
    }
}
